<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Log4j2详解 | 刘愉快的博客</title>
    <meta name="description" content="talk is cheap, show me your code">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.f6851317.css" as="style"><link rel="preload" href="/assets/js/app.a182c574.js" as="script"><link rel="preload" href="/assets/js/45.bfa5dadc.js" as="script"><link rel="prefetch" href="/assets/js/22.e0f9b22c.js"><link rel="prefetch" href="/assets/js/2.af32a167.js"><link rel="prefetch" href="/assets/js/3.0d8f9836.js"><link rel="prefetch" href="/assets/js/4.45fde388.js"><link rel="prefetch" href="/assets/js/5.c237ac7c.js"><link rel="prefetch" href="/assets/js/6.a7f6f7f5.js"><link rel="prefetch" href="/assets/js/7.dd791c92.js"><link rel="prefetch" href="/assets/js/8.fd5dc064.js"><link rel="prefetch" href="/assets/js/9.3fe2eaab.js"><link rel="prefetch" href="/assets/js/10.3650c357.js"><link rel="prefetch" href="/assets/js/11.83efe040.js"><link rel="prefetch" href="/assets/js/12.68861bfc.js"><link rel="prefetch" href="/assets/js/13.2c96f5f2.js"><link rel="prefetch" href="/assets/js/14.c738a17d.js"><link rel="prefetch" href="/assets/js/15.44c6aa0e.js"><link rel="prefetch" href="/assets/js/16.20e90af0.js"><link rel="prefetch" href="/assets/js/17.336ec91b.js"><link rel="prefetch" href="/assets/js/18.fec34f25.js"><link rel="prefetch" href="/assets/js/19.b0c35fcd.js"><link rel="prefetch" href="/assets/js/20.50623856.js"><link rel="prefetch" href="/assets/js/21.59447525.js"><link rel="prefetch" href="/assets/js/23.a5a66be0.js"><link rel="prefetch" href="/assets/js/24.6ebbaec3.js"><link rel="prefetch" href="/assets/js/25.02be3ace.js"><link rel="prefetch" href="/assets/js/26.6ae2a81c.js"><link rel="prefetch" href="/assets/js/27.5ff97c6d.js"><link rel="prefetch" href="/assets/js/28.f39f5c17.js"><link rel="prefetch" href="/assets/js/29.157090a4.js"><link rel="prefetch" href="/assets/js/30.f0a9eb14.js"><link rel="prefetch" href="/assets/js/31.cefbc3dd.js"><link rel="prefetch" href="/assets/js/32.9009e4f7.js"><link rel="prefetch" href="/assets/js/33.9731dadf.js"><link rel="prefetch" href="/assets/js/34.fa31af43.js"><link rel="prefetch" href="/assets/js/35.ff2f6407.js"><link rel="prefetch" href="/assets/js/36.d5a99da8.js"><link rel="prefetch" href="/assets/js/37.bbfdf062.js"><link rel="prefetch" href="/assets/js/38.6032701d.js"><link rel="prefetch" href="/assets/js/39.bfcbb5a9.js"><link rel="prefetch" href="/assets/js/40.c2577be3.js"><link rel="prefetch" href="/assets/js/41.5806e1f0.js"><link rel="prefetch" href="/assets/js/42.aa5a33a7.js"><link rel="prefetch" href="/assets/js/43.d3b1fd98.js"><link rel="prefetch" href="/assets/js/44.02ee5a13.js"><link rel="prefetch" href="/assets/js/46.58b398ec.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f6851317.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">刘愉快的博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">技术博文</a></div><div class="nav-item"><a href="/performance/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/bug/" class="nav-link">问题</a></div><div class="nav-item"><a href="https://github.com/liuyukuai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">技术博文</a></div><div class="nav-item"><a href="/performance/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/bug/" class="nav-link">问题</a></div><div class="nav-item"><a href="https://github.com/liuyukuai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <div class="carbon-ads"><div style="text-align: center"><a target="_blank" href="https://chuangke.aliyun.com/invite?userCode=gnzlz2if"><img src="/d467587b34de6f2c472e345868699a11.jpg"></a></div></div> <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span></span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="log4j2详解"><a href="#log4j2详解" aria-hidden="true" class="header-anchor">#</a> Log4j2详解</h1> <h2 id="介绍"><a href="#介绍" aria-hidden="true" class="header-anchor">#</a> 介绍</h2> <p>Apache Log4j 2是对Log4j的升级，它比其前身Log4j 1提供了显著的改进。并提供了许多在Logback中可用的改进，同时修复了Logback体系结构中的一些固有问题。</p> <h2 id="日志等级"><a href="#日志等级" aria-hidden="true" class="header-anchor">#</a> 日志等级</h2> <p>共有8个级别，按照从低到高为：All &lt; Trace &lt; Debug &lt; Info &lt; Warn &lt; Error &lt; Fatal &lt; OFF</p> <ul><li><p>All：最低等级的，用于打开所有日志记录.</p></li> <li><p>Trace：追踪，指定细粒度比DEBUG更低的信息事件。</p></li> <li><p>Debug：指出细粒度信息事件对调试应用程序是非常有帮助的.</p></li> <li><p>Info：消息在粗粒度级别上突出强调应用程序的运行过程.</p></li> <li><p>Warn：输出警告及warn以下级别的日志.</p></li> <li><p>Error：输出错误信息日志.</p></li> <li><p>Fatal：输出每个严重的错误事件将会导致应用程序的退出的日志.</p></li> <li><p>OFF：最高等级的，用于关闭所有日志记录.</p></li></ul> <h2 id="配置全解"><a href="#配置全解" aria-hidden="true" class="header-anchor">#</a> 配置全解</h2> <h3 id="默认配置文件（xml）"><a href="#默认配置文件（xml）" aria-hidden="true" class="header-anchor">#</a> 默认配置文件（XML）</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Configuration</span> <span class="token attr-name">status</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>WARN<span class="token punctuation">&quot;</span></span> <span class="token attr-name">monitorinterval</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Appenders</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Console</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Console<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SYSTEM_OUT<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Console</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Appenders</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>error<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Console<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Root</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="配置属性详解（xml）"><a href="#配置属性详解（xml）" aria-hidden="true" class="header-anchor">#</a> 配置属性详解（xml）</h3> <h4 id="configuration"><a href="#configuration" aria-hidden="true" class="header-anchor">#</a> Configuration</h4> <p>Configuration有两个属性:status 和 monitorinterval</p> <ul><li><p>status: 用来指定log4j本身的打印日志的级别.</p></li> <li><p>monitorinterval: 用于指定log4j自动重新配置的监测间隔时间，单位是s,最小是5s。</p></li></ul> <h3 id="appenders"><a href="#appenders" aria-hidden="true" class="header-anchor">#</a> Appenders</h3> <p>Appender负责将LogEvents传递到目的地。每个Appender都必须实现Appender接口，常用的有三种子节点:Console、RollingFile、File。</p> <h3 id="loggers"><a href="#loggers" aria-hidden="true" class="header-anchor">#</a> Loggers</h3> <p>Loggers节点，常见的有两种:Root和Logger.</p> <h3 id="console"><a href="#console" aria-hidden="true" class="header-anchor">#</a> Console</h3> <p>Console节点用来定义输出到控制台的Appender.</p> <ul><li><p>name：指定Appender的名字.</p></li> <li><p>target：SYSTEM_OUT 或 SYSTEM_ERR,一般只设置默认:SYSTEM_OUT.</p></li> <li><p>PatternLayout：输出格式，不设置默认为:%m%n.</p></li></ul> <div class="tip custom-block"><p class="custom-block-title">说明</p> <p>常用的格式</p> <ul><li>%p：输出日志信息优先级，即DEBUG，INFO，WARN，ERROR，FATAL</li> <li>%d：输出日志时间点的日期或时间，默认格式为ISO8601，也可以在其后指定格式，比如：%d{yyy MMM dd HH:mm:ss,SSS}，输出类似：2002年10月18日 22：10：28，921</li> <li>%r：输出自应用启动到输出该log信息耗费的毫秒数</li> <li>%c：输出日志信息所属的类目，通常就是所在类的全名</li> <li>%t：输出产生该日志事件的线程名</li> <li>%l：输出日志事件的发生位置，相当于%C.%M(%F:%L)的组合,包括类目名、发生的线程，以及在代码中的行数</li> <li>%x：输出和当前线程相关联的NDC(嵌套诊断环境),尤其用到像java servlets这样的多客户多线程的应用中</li> <li>%%：输出一个&quot;%&quot;字符</li> <li>%F：输出日志消息产生时所在的文件名称</li> <li>%L：输出代码中的行号</li> <li>%m：输出代码中指定的消息,产生的日志具体信息</li> <li>%n：输出一个回车换行符，Windows平台为&quot;/r/n&quot;，Unix平台为&quot;/n&quot;输出日志信息换行</li></ul> <p>可以在%与模式字符之间加上修饰符来控制其最小宽度、最大宽度、和文本的对齐方式。</p> <ul><li>%20c：指定输出category的名称，最小的宽度是20，如果category的名称小于20的话，默认的情况下右对齐。</li> <li>%-20c：指定输出category的名称，最小的宽度是20，如果category的名称小于20的话，&quot;-&quot;号指定左对齐。</li> <li>%.30c：指定输出category的名称，最大的宽度是30，如果category的名称大于30的话，就会将左边多出的字符截掉，但小于30的话也不会有空格。</li> <li>%20.30c：如果category的名称小于20就补空格，并且右对齐，如果其名称长于30字符，就从左边较远输出的字符截掉。</li></ul></div> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token comment">&lt;!--这个输出控制台的配置--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Console</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Console<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SYSTEM_OUT<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Console</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h3 id="file"><a href="#file" aria-hidden="true" class="header-anchor">#</a> File</h3> <p>FileAppender用于将日志写入到一个文件中，该文件由fileName参数指定。有几个重要的参数：</p> <ul><li><p>name：指定Appender的名字</p></li> <li><p>fileName：指定输出日志的目的文件带全路径的文件名。</p></li> <li><p>append：默认为true，记录追加到文件的最后，否则就先清除以前的记录再写入</p></li> <li><p>bufferedIO：默认true，记录将会写入到缓存区，当缓存区满的时候，就会写入磁盘。或者如果设置immediateFlush将会立即写入。文件锁定不能和bufferedIO一起使用</p></li> <li><p>bufferSize：当bufferedIO设置为true时，默认是8192 bytes</p></li> <li><p>locking：是否对文件上锁，当有多个线程可能同时写该文件时需要考虑上锁，但对文件上锁会影响系统的性能，所以需要谨慎使用。默认值是false</p></li> <li><p>PatternLayout：输出格式，不设置默认为:%m%n</p></li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token comment">&lt;!--文件会打印出所有信息，这个log每次运行程序会自动清空，由append属性决定，这个也挺有用的，适合临时测试用--&gt;</span>
<span class="token comment">&lt;!--append = true : 保留启动前的日志，追加新日志，false： 清空原有日志--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>log<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fileName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>log/all.log<span class="token punctuation">&quot;</span></span> <span class="token attr-name">append</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>%d{HH:mm:ss.SSS} %-5level %class{36} %L %M - %msg%xEx%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>完整参数见<a href="http://logging.apache.org/log4j/2.x/manual/appenders.html#FileAppender" target="_blank" rel="noopener noreferrer">官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="rollingfile"><a href="#rollingfile" aria-hidden="true" class="header-anchor">#</a> RollingFile</h3> <p>RollingFileAppender是一个非常有意思的输出器。它将日志信息写入一个文件后，会判断是否满足封存文件的要求，若满足，则除非封存文件的动作。RollingFileAppender需要TriggeringPolicy来指定触发封存的条件，另外还需要RolloverStrategy来告诉输出器如何封存文件。</p> <ul><li><p>name：指定Appender的名字</p></li> <li><p>fileName：指定输出日志的目的文件带全路径的文件名。</p></li> <li><p>append：默认为true，记录追加到文件的最后，否则就先清除以前的记录再写入</p></li> <li><p>bufferedIO：默认true，记录将会写入到缓存区，当缓存区满的时候，就会写入磁盘。或者如果设置immediateFlush将会立即写入。文件锁定不能和bufferedIO一起使用</p></li> <li><p>bufferSize：当bufferedIO设置为true时，默认是8192 bytes</p></li> <li><p>locking：是否对文件上锁，当有多个线程可能同时写该文件时需要考虑上锁，但对文件上锁会影响系统的性能，所以需要谨慎使用。默认值是false</p></li> <li><p>PatternLayout：输出格式，不设置默认为:%m%n</p></li> <li><p>filePattern：新建文件名称格式和路径</p></li></ul> <div class="tip custom-block"><p class="custom-block-title">说明</p> <ul><li>filePattern文件名若以.gz结尾，文件会被压缩</li> <li>filePattern文件名若以.log结尾，文件不会被压缩</li></ul></div> <ul><li><p>Policies：是组合滚动日志策略的标签，指定滚动日志的策略，就是什么时候进行新建日志文件输出日志</p></li> <li><p>Filters： 是组合过滤器的标签，它包含的子标签是具体的过滤器</p></li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingFile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>RollingFileInfo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fileName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>logs/info.log<span class="token punctuation">&quot;</span></span>
             <span class="token attr-name">filePattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>logs/info-%d{yyyy-MM-dd HH-mm}-%i.log.gz<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ThresholdFilter</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ACCEPT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMismatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>DENY<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>%d{HH:mm:ss.SSS} %-5level %class{36} %L %M - %msg%xEx%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Policies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--4分钟rollover一次--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TimeBasedTriggeringPolicy</span> <span class="token attr-name">interval</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>4<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--文件大小--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SizeBasedTriggeringPolicy</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1 MB<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Policies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--文件数量--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DefaultRolloverStrategy</span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingFile</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h3 id="policies-滚动日志的策略"><a href="#policies-滚动日志的策略" aria-hidden="true" class="header-anchor">#</a> Policies 滚动日志的策略</h3> <ul><li>TimeBasedTriggeringPolicy</li></ul> <div class="tip custom-block"><p class="custom-block-title">说明</p> <p>基于时间的滚动策略</p> <ul><li>此参数需要与filePattern结合使用，规定了触发rollover的频率，默认值为1。<br></li> <li>假设interval为4，若filePattern的最小时间粒度为小时(如yyyy-MM-dd HH)，则每4小时触发一次rollover。<br></li> <li>假设interval为2，若filePattern的最小时间粒度为小时(如yyyy-MM-dd HH:mm )，则每2分钟触发一次rollover。</li> <li>指明是否对interval进行调节，默认为false。若modulate为true，会以0为开始对interval进行偏移计算。例如，最小时间粒度为小时，当前为3:00，interval为4，则以后触发rollover的时间依次为4:00，8:00，12:00，16:00,...。</li></ul></div> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingFile</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--单独使用--&gt;</span>
    <span class="token comment">&lt;!--&lt;TimeBasedTriggeringPolicy interval=&quot;4&quot;/&gt;--&gt;</span>
    <span class="token comment">&lt;!--组合使用--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Policies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TimeBasedTriggeringPolicy</span> <span class="token attr-name">interval</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>4<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Policies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingFile</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ul><li>SizeBasedTriggeringPolicy</li></ul> <div class="tip custom-block"><p class="custom-block-title">说明</p> <p>基于指定文件大小的滚动策略</p> <ul><li>这一触发策略基于对log文件大小的判断。当log文件大于设定的阈值时，将触发封存动作。可设定的log文件大小的单位有bytes、KB、MB或GB。</li></ul></div> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingFile</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--单独使用--&gt;</span>
    <span class="token comment">&lt;!--&lt;SizeBasedTriggeringPolicy size=&quot;1 MB&quot;/&gt;--&gt;</span>
    <span class="token comment">&lt;!--组合使用--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Policies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SizeBasedTriggeringPolicy</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1 MB<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Policies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingFile</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ul><li>OnStartupTriggeringPolicy</li></ul> <div class="tip custom-block"><p class="custom-block-title">说明</p> <ul><li>它会自行判断log文件的创建时间和JVM的启动时间。若log文件的创建时间早于JVM的启动时间，则将原来的log文件封存，然后创建一个新的空白log文件。</li> <li>minSize：文件必须滚动的最小大小。无论文件大小如何，0大小都会导致滚动。默认值是1，这将防止滚动一个空文件。</li></ul></div> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingFile</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--单独使用--&gt;</span>
    <span class="token comment">&lt;!--&lt;OnStartupTriggeringPolicy/&gt;--&gt;</span>
    <span class="token comment">&lt;!--组合使用--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Policies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OnStartupTriggeringPolicy</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Policies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingFile</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ul><li>CompositeTriggeringPolicy</li></ul> <div class="tip custom-block"><p class="custom-block-title">说明</p> <p>复合型触发策略</p> <ul><li>对应标签Policies</li> <li>即将多个触发条件组合到一起，这些触发条件是或的关系，只要其中一个条件满足，则触发封存动作。</li></ul></div> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingFile</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Policies</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TimeBasedTriggeringPolicy</span> <span class="token attr-name">interval</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>4<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SizeBasedTriggeringPolicy</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1 MB<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Policies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingFile</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h3 id="rolloverstrategy"><a href="#rolloverstrategy" aria-hidden="true" class="header-anchor">#</a> RolloverStrategy</h3> <ul><li>DefaultRolloverStrategy</li></ul> <div class="tip custom-block"><p class="custom-block-title">说明</p> <p>文件命名模式下保留文件的个数</p> <ul><li>fileIndex：有两个选择“max”或“min”。设置为“max”意味着将最新的日志信息封存在序号较大的封存文件中。“min”则相反。默认为max</li> <li>min： 封存文件的序号的起始值，默认值为1</li> <li>max： 封存文件的序号的最大值</li> <li>compressionLevel：压缩等级，0-9，只对zip有效</li></ul> <p>假设fileIndex设置为min，min属性设置为1,max属性设置为3，文件名是“foo”。，文件名模式为“foo-%i.log”，最新的日志在index小的文件中。</p> <ul><li>rollover=0时，所有日志都输入到foo.log中</li> <li>rollover=1时，foo.log会重命名为foo-1.log，并创建新的foo.log的文件写入</li> <li>rollover=2时，foo-1.log会重命名为foo-2.log，foo.log会重命名为foo-1.log，并创建新的foo.log的文件写入</li> <li>rollover=3时，foo-2.log会重命名为foo-3.log，foo-1.log会重命名为foo-2.log，foo.log会重命名为foo-1.log，并创建新的foo.log的文件写入</li> <li>rollover=4时，foo-3.log文件会被删除，foo-2.log会重命名为foo-3.log，foo-1.log会重命名为foo-2.log，foo.log会重命名为foo-1.log，并创建新的foo.log的文件写入</li></ul> <p>假设fileIndex设置为max，min属性设置为1,max属性设置为3，文件名是“foo”。，文件名模式为“foo-%i.log”，最新的日志在index大的文件中。</p> <ul><li>rollover=0时，所有日志都输入到foo.log中</li> <li>rollover=1时，foo.log会重命名为foo-1.log，并创建新的foo.log的文件写入</li> <li>rollover=2时，foo.log会重命名为foo-2.log，并创建新的foo.log的文件写入</li> <li>rollover=3时，foo.log会重命名为foo-3.log，并创建新的foo.log的文件写入</li> <li>rollover=4时，foo-1.log文件会被删除，foo-2.log会重命名为foo-1.log，foo-3.log会重命名为foo-2.log，foo.log会重命名为foo-3.log，并创建新的foo.log的文件写入</li></ul></div> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingFile</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DefaultRolloverStrategy</span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingFile</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ul><li>Delete on Rollover</li></ul> <div class="tip custom-block"><p class="custom-block-title">说明</p> <ul><li>2.5+引入删除操作，该操作使用户能够控制在翻转时删除哪些文件，而不是使用DefaultRolloverStrategy max属性。</li> <li>Delete操作允许用户配置一个或多个条件，这些条件选择要相对于基本目录删除的文件。</li> <li>basePath：扫描日志文件根路径，必须配置</li> <li>maxDepth：日志文件可见的层级，默认为1，最大值为Integer.MAX_VALUE，若为1，只扫描根目录下的文件，若为MAX_VALUE扫描所有层级的文件。</li> <li>IfFileName：删除的条件之一，文件名称匹配</li> <li>IfLastModified：删除的条件之一，文件最后修改时间匹配</li> <li>IfAny：要保留的文件</li> <li>IfAccumulatedFileSize：按文件大小保留最近文件，exceeds=&quot;100 GB&quot;，保留最近100GB的文件</li> <li>IfAccumulatedFileCount：按文件数量，exceeds=&quot;10&quot;，保留最近的10个文件</li></ul></div> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DefaultRolloverStrategy</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Delete</span> <span class="token attr-name">basePath</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>logs_2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxDepth</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfFileName</span> <span class="token attr-name">glob</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*/info-*.log.gz<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfLastModified</span> <span class="token attr-name">age</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>60d<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--要保留的文件--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfAny</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfAccumulatedFileSize</span> <span class="token attr-name">exceeds</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>100 GB<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfAccumulatedFileCount</span> <span class="token attr-name">exceeds</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>IfAny</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Delete</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DefaultRolloverStrategy</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>更多Rollover见<a href="http://logging.apache.org/log4j/2.x/manual/appenders.html#FileAppender" target="_blank" rel="noopener noreferrer">官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="filters"><a href="#filters" aria-hidden="true" class="header-anchor">#</a> filters</h3> <div class="tip custom-block"><p class="custom-block-title">说明</p> <p>日志过滤器</p> <ul><li>onMatch和onMismatch可选的值分别是，ACCEPT（接受）, DENY（拒绝）, NEUTRAL（中立)</li> <li>Accept意味着其他的Filter都不应该再被调用，而事件应该被处理。</li> <li>Deny意味着事件应该被立即忽略，且将控制讲给调用处。</li> <li>Neutral代表事件应该被传递给其他的Filter。如果没有其他Filter，则事件将被处理。</li></ul></div> <ul><li>ThresholdFilter</li></ul> <div class="tip custom-block"><p class="custom-block-title">说明</p> <p>日志等级过滤器</p> <ul><li>level：日志等级，比如debug，info等</li></ul></div> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingFile</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--单独使用--&gt;</span>
    <span class="token comment">&lt;!--只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>
    <span class="token comment">&lt;!--&lt;ThresholdFilter level=&quot;debug&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;--&gt;</span>
    <span class="token comment">&lt;!--组合使用--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filters</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ThresholdFilter</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>debug<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ACCEPT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMismatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>DENY<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filters</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingFile</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ul><li>RegexFilter</li></ul> <div class="tip custom-block"><p class="custom-block-title">说明</p> <p>正则过滤器</p> <ul><li>regex：正则表达式</li></ul></div> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingFile</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--单独使用--&gt;</span>
    <span class="token comment">&lt;!--只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>
    <span class="token comment">&lt;!--&lt;RegexFilter regex=&quot;*.pay.*&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;--&gt;</span>
    <span class="token comment">&lt;!--组合使用--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filters</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RegexFilter</span> <span class="token attr-name">regex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*.pay.*<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">onMatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ACCEPT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMismatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>DENY<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filters</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingFile</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ul><li>TimeFilter</li></ul> <div class="tip custom-block"><p class="custom-block-title">说明</p> <p>时间段过滤器</p> <ul><li>start：开始时间</li> <li>end：截止时间</li></ul></div> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingFile</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--单独使用--&gt;</span>
    <span class="token comment">&lt;!--只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>
    <span class="token comment">&lt;!--&lt;TimeFilter start=&quot;05:00:00&quot; end=&quot;05:30:00&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;--&gt;</span>
    <span class="token comment">&lt;!--组合使用--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filters</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TimeFilter</span> <span class="token attr-name">start</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>05:00:00<span class="token punctuation">&quot;</span></span> <span class="token attr-name">end</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>05:30:00<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ACCEPT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMismatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>DENY<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filters</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingFile</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>更多Filters见<a href="http://logging.apache.org/log4j/2.x/manual/filters.html" target="_blank" rel="noopener noreferrer">官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="loggers-2"><a href="#loggers-2" aria-hidden="true" class="header-anchor">#</a> loggers</h3> <ul><li>Root节点来指定项目的根日志，如果没有单独指定Logger，那么默认使用Root日志输出</li></ul> <div class="tip custom-block"><p class="custom-block-title">说明</p> <ul><li>定义的appender必须要在loggers里面声明才能生效</li> <li>level：日志输出级别，共有8个级别，按照从低到高为：All &lt; Trace &lt; Debug &lt; Info &lt; Warn &lt; Error &lt; Fatal &lt; OFF.</li> <li>AppenderRef：Root的子节点，用来指定该日志输出到哪个Appender.</li></ul></div> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Console<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Root</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ul><li>Logger节点用来单独指定日志的形式，比如要为指定包下的class指定不同的日志级别等。</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Console<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Root</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><div class="tip custom-block"><p class="custom-block-title">说明</p> <p>时间段过滤器</p> <ul><li>level：日志输出级别，共有8个级别，按照从低到高为：All &lt; Trace &lt; Debug &lt; Info &lt; Warn &lt; Error &lt; Fatal &lt; OFF.</li> <li>name：用来指定该Logger所适用的类或者类所在的包全路径,继承自Root节点.</li> <li>AppenderRef：Logger的子节点，用来指定该日志输出到哪个Appender,如果没有指定，就会默认继承自Root.如果指定了，那么会在指定的这个Appender和Root的Appender中都会输出，此时我们可以设置Logger的additivity=&quot;false&quot;只在自定义的Appender中进行输出。</li> <li>logger async 用的是无锁并发技术，必须引入Disruptor</li> <li>includeLocation：位置信息，比如哪个类默认为true</li></ul></div> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--同步--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.itxiaoer.logging.pay<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>trace<span class="token punctuation">&quot;</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>payRollingFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Logger</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--异步--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AsyncLogger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.itxiaoer.logging.biz<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>trace<span class="token punctuation">&quot;</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">includeLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bizRollingFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>AsyncLogger</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Console<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Root</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--异步--&gt;</span>
    <span class="token comment">&lt;!--&lt;asyncRoot&gt;&lt;/asyncRoot&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="完整配置"><a href="#完整配置" aria-hidden="true" class="header-anchor">#</a> 完整配置</h2> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Configuration</span> <span class="token attr-name">status</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>TRACE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">monitorinterval</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--配置常量--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>baseDir<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>logs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Appenders</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--这个输出控制台的配置--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Console</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Console<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SYSTEM_OUT<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Console</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--文件会打印出所有信息，这个log每次运行程序会自动清空，由append属性决定，这个也挺有用的，适合临时测试用--&gt;</span>
        <span class="token comment">&lt;!--append = true : 保留启动前的日志，追加新日志，false： 清空原有日志--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>log<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fileName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${baseDir}/all.log<span class="token punctuation">&quot;</span></span> <span class="token attr-name">append</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>%d{HH:mm:ss.SSS} %-5level %class{36} %L %M - %msg%xEx%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingFile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>RollingFile_1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fileName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${baseDir}/logs_1/info.log<span class="token punctuation">&quot;</span></span>
                     <span class="token attr-name">filePattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${baseDir}/logs_1/$${date:yyyy-MM}/info-%d{yyyy-MM-dd HH-mm}-%i.log.gz<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ThresholdFilter</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ACCEPT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMismatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>DENY<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>%d{HH:mm:ss.SSS} %-5level %class{36} %L %M - %msg%xEx%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Policies</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!--4分钟rollover一次--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TimeBasedTriggeringPolicy</span> <span class="token attr-name">interval</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>4<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token comment">&lt;!--文件大小--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SizeBasedTriggeringPolicy</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1 MB<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Policies</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--文件数量--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DefaultRolloverStrategy</span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingFile</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--删除历史日志文件--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingRandomessFile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>RollingFile_2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fileName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${baseDir}/logs_2/info.log<span class="token punctuation">&quot;</span></span>
                     <span class="token attr-name">filePattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${baseDir}/logs_2/$${date:yyyy-MM}/info-%d{yyyy-MM-dd HH-mm}-%i.log.gz<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ThresholdFilter</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>debug<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ACCEPT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMismatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>DENY<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>%d{HH:mm:ss.SSS} %-5level %class{36} %L %M - %msg%xEx%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Policies</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!--1分钟rollover一次--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TimeBasedTriggeringPolicy</span> <span class="token attr-name">interval</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token comment">&lt;!--文件大小--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SizeBasedTriggeringPolicy</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1 MB<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Policies</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--文件数量--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DefaultRolloverStrategy</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Delete</span> <span class="token attr-name">basePath</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${baseDir}/logs_2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxDepth</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfFileName</span> <span class="token attr-name">glob</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*/info-*.log.gz<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfLastModified</span> <span class="token attr-name">age</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>5m<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Delete</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DefaultRolloverStrategy</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingRandomessFile</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--pay--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingFile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>payRollingFile<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fileName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${baseDir}/pay/info.log<span class="token punctuation">&quot;</span></span>
                     <span class="token attr-name">filePattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${baseDir}/pay/$${date:yyyy-MM}/info-%d{yyyy-MM-dd HH-mm}-%i.log.gz<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ThresholdFilter</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>debug<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ACCEPT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMismatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>DENY<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>%d{HH:mm:ss.SSS} %-5level %class{36} %L %M - %msg%xEx%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Policies</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!--1分钟rollover一次--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TimeBasedTriggeringPolicy</span> <span class="token attr-name">interval</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token comment">&lt;!--文件大小--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SizeBasedTriggeringPolicy</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1 MB<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Policies</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--文件数量--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DefaultRolloverStrategy</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Delete</span> <span class="token attr-name">basePath</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${baseDir}/pay<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxDepth</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfFileName</span> <span class="token attr-name">glob</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*/info-*.log.gz<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfLastModified</span> <span class="token attr-name">age</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>5m<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Delete</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DefaultRolloverStrategy</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingFile</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--biz--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingFile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bizRollingFile<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fileName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${baseDir}/biz/info.log<span class="token punctuation">&quot;</span></span>
                     <span class="token attr-name">filePattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${baseDir}/biz/$${date:yyyy-MM}/info-%d{yyyy-MM-dd HH-mm}-%i.log.gz<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ThresholdFilter</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>debug<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ACCEPT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMismatch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>DENY<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>%d{HH:mm:ss.SSS} %-5level %class{36} %L %M - %msg%xEx%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Policies</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!--1分钟rollover一次--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TimeBasedTriggeringPolicy</span> <span class="token attr-name">interval</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token comment">&lt;!--文件大小--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SizeBasedTriggeringPolicy</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1 MB<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Policies</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--文件数量--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DefaultRolloverStrategy</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Delete</span> <span class="token attr-name">basePath</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${baseDir}/biz<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxDepth</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfFileName</span> <span class="token attr-name">glob</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*/info-*.log.gz<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfLastModified</span> <span class="token attr-name">age</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>5m<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Delete</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DefaultRolloverStrategy</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingFile</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Appenders</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.itxiaoer.logging.pay<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>trace<span class="token punctuation">&quot;</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>payRollingFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Logger</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AsyncLogger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.itxiaoer.logging.biz<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>trace<span class="token punctuation">&quot;</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bizRollingFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>AsyncLogger</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Console<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>log<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>RollingFile_1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>RollingFile_2<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Root</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><a href="https://github.com/liuyukuai/demo-spring-cloud" target="_blank" rel="noopener noreferrer">完整代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/45.bfa5dadc.js" defer></script><script src="/assets/js/app.a182c574.js" defer></script>
  </body>
</html>
